CREATE DATABASE HospedajeReal;
 \c hospedajereal;
CREATE TABLE TIPO_DOC (
	Id_Tipo_Doc integer NOT NULL,
	Tipo_Docu VARCHAR(30) NOT NULL,
	PRIMARY KEY (Id_Tipo_Doc)
);

CREATE TABLE NACIONALIDAD(
	Id_Nacio INTEGER NOT NULL,
	Pais_Origen VARCHAR(25) NOT NULL, 
	PRIMARY KEY (Id_Nacio)
);

CREATE TABLE PERSONA (
	Id_Persona VARCHAR(30) NOT NULL,
	Id_Nacio INTEGER NOT NULL, 
	Id_Tipo_Doc INTEGER NOT NULL, 
	Nombre VARCHAR(155) NOT NULL,
	Correo VARCHAR(50) NULL, 
	FOREIGN KEY (Id_Nacio) REFERENCES NACIONALIDAD (Id_Nacio),
	FOREIGN KEY (Id_Tipo_Doc) REFERENCES TIPO_DOC (Id_Tipo_Doc),
	PRIMARY KEY (Id_Persona)
);

CREATE TABLE CARGO (
	Id_Cargo INTEGER NOT NULL, 
	Cargo VARCHAR(30) NOT NULL, 
	PRIMARY KEY (Id_Cargo) 
);

CREATE TABLE EMPLEADO (
	Id_Empleado VARCHAR(30) NOT NULL, 
	Contrasena VARCHAR(20) NOT NULL,
	Id_Cargo INTEGER NOT NULL,
	Id_Persona VARCHAR(30) NOT NULL,
	FOREIGN KEY (Id_Cargo) REFERENCES CARGO (Id_Cargo), 
	FOREIGN KEY (Id_Persona) REFERENCES PERSONA(Id_Persona),
	PRIMARY KEY (Id_Empleado)	
);

CREATE TABLE NOMBRE_SERVICIO (
	Id_NomS INTEGER NOT NULL, 
	Servicio VARCHAR(30) NOT NULL,
	PRIMARY KEY (Id_NomS)
); 

CREATE TABLE CATEGORIA (
	Id_Categoria INTEGER NOT NULL,
	Categoria VARCHAR(30) NOT NULL, 
	PRIMARY KEY (Id_Categoria)
);

CREATE TABLE SERVICIO (
	Id_Servicio INTEGER NOT NULL, 
	Id_NomS INTEGER NOT NULL, 
	Id_Categoria INTEGER NOT NULL, 
	Descripcion TEXT NULL,
	Precio REAL NOT NULL,
	FOREIGN KEY (Id_NomS) REFERENCES NOMBRE_SERVICIO(Id_NomS),
	FOREIGN KEY (Id_Categoria) REFERENCES CATEGORIA (Id_Categoria),
	PRIMARY KEY (Id_Servicio)
);

CREATE TABLE TIPO_HABITACION (
	Id_Tipo INTEGER NOT NULL, 
	Tipo_H VARCHAR(20) NOT NULL,
	PRIMARY KEY (Id_Tipo)
);

CREATE TABLE HABITACION (
	Nro_Habitacion INTEGER NOT NULL, 
	Id_Tipo INTEGER NOT NULL,
	Valor_Habitacion REAL NOT NULL,
	Descripcion TEXT NULL,
	Nro_Persona INTEGER NOT NULL, 
	FOREIGN KEY (Id_Tipo) REFERENCES TIPO_HABITACION(Id_Tipo),
	PRIMARY KEY (Nro_Habitacion)
);

CREATE TABLE HABITACION_SERVICIO (
	Nro_Habitacion INTEGER NOT NULL, 
	Id_Servicio INTEGER NOT NULL,
	Cantidad INTEGER NULL,
	FOREIGN KEY (Nro_Habitacion) REFERENCES HABITACION(Nro_Habitacion),
	FOREIGN KEY (Id_Servicio) REFERENCES SERVICIO (Id_Servicio),
	PRIMARY KEY (Nro_Habitacion, Id_Servicio)
);

CREATE TABLE ENTIDAD (
	Id_Entidad INTEGER NOT NULL, 
	Entidad VARCHAR(20) NOT NULL, 
	PRIMARY KEY (Id_Entidad)
);

CREATE TABLE NOMBRE_TP (
	Id_NombreTP INTEGER NOT NULL,
	Tipo_Pago VARCHAR(15) NOT NULL, 
	PRIMARY KEY (Id_NombreTP)
);

CREATE TABLE TIPO_PAGO (
	Id_Tipo_Pago INTEGER NOT NULL,
	Id_Entidad INTEGER NOT NULL,
	Id_NombreTP INTEGER NOT NULL,
	FOREIGN KEY (Id_Entidad) REFERENCES ENTIDAD(Id_Entidad),
	FOREIGN KEY (Id_NombreTP) REFERENCES NOMBRE_TP (Id_NombreTP),
	PRIMARY KEY (Id_Tipo_Pago) 
);

CREATE TABLE CLIENTE (
	Id_Cliente VARCHAR(30) NOT NULL,
	ContrasenaC VARCHAR(20) NULL,
	Id_Persona VARCHAR(30) NOT NULL,
	Nro_Habitacion INTEGER NOT NULL,
	FOREIGN KEY (Id_Persona) REFERENCES PERSONA (Id_Persona),
	FOREIGN KEY (Nro_Habitacion) REFERENCES HABITACION(Nro_Habitacion),
	PRIMARY KEY (Id_Cliente)
);

CREATE TABLE TELEFONO_CLIENTE (
	Telefono VARCHAR(30) NOT NULL,
	Id_Cliente VARCHAR(30) NOT NULL,
	FOREIGN KEY (Id_Cliente) REFERENCES CLIENTE(Id_Cliente),
	PRIMARY KEY (Telefono, Id_Cliente)	
);

CREATE TABLE CLIENTE_TIPO_PAGO (
	Id_Cliente VARCHAR(30) NOT NULL, 
	Id_Tipo_Pago INTEGER NOT NULL,
	Nro_Cuenta VARCHAR(30) NULL,
	FOREIGN KEY (Id_Cliente) REFERENCES CLIENTE (Id_Cliente),
	FOREIGN KEY (Id_Tipo_Pago) REFERENCES TIPO_PAGO(Id_Tipo_Pago),
	PRIMARY KEY (Id_Cliente,Id_Tipo_Pago)
);

CREATE TABLE RESERVA(
	Id_Reserva INTEGER NOT NULL,
	Pago REAL NULL,
	Fecha_Hora_Entrada TIMESTAMP  NULL,
	Fecha_Hora_Salida  TIMESTAMP  NULL,
	Hora_Impresion TIME NULL, 
	Id_Empleado VARCHAR (30) NOT NULL,
	Id_Cliente VARCHAR (30) NOT NULL,
	Cantidad INTEGER NOT NULL,
	FOREIGN KEY (Id_Cliente) REFERENCES CLIENTE (Id_Cliente),
	FOREIGN KEY (Id_Empleado) REFERENCES EMPLEADO(Id_Empleado),
	PRIMARY KEY(Id_Reserva)
); 

CREATE TABLE RESERVA_HABITACION(
	Id_Reserva INTEGER NOT NULL,
	Nro_Habitacion INTEGER NOT NULL,
	Fecha_Llegada DATE NOT NULL,
	Fecha_Salida DATE NOT NULL,
	FOREIGN KEY (Id_Reserva) REFERENCES RESERVA(Id_Reserva),
	FOREIGN KEY (Nro_Habitacion) REFERENCES HABITACION(Nro_Habitacion),
	PRIMARY KEY (Fecha_Llegada,Fecha_Salida,Nro_Habitacion,Id_Reserva)
);

-- Secuencia Cliente

CREATE SEQUENCE seq_reserva
INCREMENT 5 START 9040;

ALTER TABLE reserva 
ALTER id_reserva 
SET DEFAULT NEXTVAL ('seq_reserva');

-- Secuencia Cliente

CREATE SEQUENCE seq_cliente
INCREMENT 5 START 9015;

ALTER TABLE CLIENTE
ALTER id_cliente 
SET DEFAULT NEXTVAL ('seq_cliente');


